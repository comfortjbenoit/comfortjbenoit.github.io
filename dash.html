<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Invoice Item Search</title>

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, Arial, sans-serif;
    padding: 12px;
    background: #f5f5f5;
}

h2 {
    margin-bottom: 10px;
}

input[type="file"],
input[type="text"] {
    width: 100%;
    padding: 12px;
    font-size: 16px; /* prevents iOS zoom */
    margin-bottom: 10px;
}

#count {
    font-size: 14px;
    margin-bottom: 8px;
}

.card {
    background: #fff;
    border-radius: 8px;
    padding: 10px 12px;
    margin-bottom: 10px;
    box-shadow: 0 1px 3px rgba(0,0,0,.1);
}

.desc {
    font-weight: 600;
    margin-bottom: 4px;
}

.date {
    font-size: 13px;
    color: #444;
    margin-bottom: 6px;
}

.row {
    display: flex;
    flex-wrap: wrap;
    font-size: 14px;
    gap: 12px;
}

.row span {
    white-space: nowrap;
}

.muted {
    color: #555;
    font-size: 13px;
}
</style>
</head>

<body>

<h2>Invoice Search</h2>

<input type="file" id="csvFile" accept=".csv">
<input type="text" id="searchBox" placeholder="Search Item Code, UPC, or Description">

<div id="count"></div>
<div id="results"></div>

<script>
let rows = [];

document.getElementById("csvFile").addEventListener("change", e => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => parseCSV(reader.result);
    reader.readAsText(file);
});

document.getElementById("searchBox").addEventListener("input", e => {
    const q = e.target.value.toLowerCase().trim();
    if (!q) {
        render([]);
        document.getElementById("count").textContent = "";
        return;
    }

    const matches = rows.filter(r =>
        (r["Item Code"] || "").toLowerCase().includes(q) ||
        (r["UPC"] || "").toLowerCase().includes(q) ||
        (r["Desc"] || "").toLowerCase().includes(q)
    );

    render(matches.slice(0, 200));
    document.getElementById("count").textContent =
        `${matches.length} match(es)`;
});

function parseCSV(text) {
    const lines = text.split(/\r?\n/).filter(l => l.trim());
    const headers = lines[0].split(",").map(h => h.replace(/"/g, "").trim());

    rows = lines.slice(1).map(line => {
        const values = parseLine(line);
        let obj = {};
        headers.forEach((h, i) => obj[h] = values[i] || "");
        return obj;
    });
}

function parseLine(line) {
    let res = [];
    let cur = "";
    let q = false;

    for (let i = 0; i < line.length; i++) {
        let c = line[i];
        if (c === '"' && line[i + 1] === '"') {
            cur += '"'; i++;
        } else if (c === '"') {
            q = !q;
        } else if (c === "," && !q) {
            res.push(cur); cur = "";
        } else {
            cur += c;
        }
    }
    res.push(cur);
    return res;
}

function render(data) {
    const out = document.getElementById("results");
    out.innerHTML = "";

    data.forEach(r => {
        const card = document.createElement("div");
        card.className = "card";

        card.innerHTML = `
            <div class="desc">${r["Desc"] || ""}</div>

            <div class="date">
                ðŸ“… Invoice Date: ${r["Invoice Date"] || ""}
            </div>

            <div class="row">
                <span>QTY: ${r["Qty"] || ""}</span>
                <span>PK: ${r["PK"] || ""}</span>
                <span>SZ: ${r["SZ"] || ""}</span>
                <span>UNIT: ${r["Unit Cost"] || ""}</span>
                <span>@20%: ${r["@20%"] || ""}</span>
            </div>

            <div class="row muted">
                <span>UPC: ${r["UPC"] || ""}</span>
                <span>ITEM: ${r["Item Code"] || ""}</span>
            </div>
        `;
        out.appendChild(card);
    });
}
</script>

</body>
</html>
