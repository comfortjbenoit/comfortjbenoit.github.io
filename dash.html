<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Invoice Item Search</title>

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, Arial, sans-serif;
    padding: 12px;
    background: #f8f8f8;
}

h2 {
    margin-bottom: 10px;
}

input[type="file"],
input[type="text"] {
    width: 100%;
    padding: 12px;
    font-size: 16px; /* prevents iOS zoom */
    margin-bottom: 10px;
}

#count {
    margin: 8px 0;
    font-size: 14px;
}

table {
    width: 100%;
    border-collapse: collapse;
    background: #fff;
}

th, td {
    padding: 8px;
    border-bottom: 1px solid #ddd;
    font-size: 14px;
}

th {
    background: #efefef;
    position: sticky;
    top: 0;
}

tr:active {
    background: #f0f0f0;
}
</style>
</head>

<body>

<h2>Invoice Search</h2>

<input type="file" id="csvFile" accept=".csv">
<input type="text" id="searchBox" placeholder="Search Item Code, UPC, or Description">

<div id="count"></div>

<table>
    <thead id="thead"></thead>
    <tbody id="tbody"></tbody>
</table>

<script>
let headers = [];
let rows = [];

document.getElementById("csvFile").addEventListener("change", e => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => parseCSV(reader.result);
    reader.readAsText(file);
});

document.getElementById("searchBox").addEventListener("input", e => {
    const q = e.target.value.toLowerCase().trim();
    if (q.length === 0) {
        render([]);
        document.getElementById("count").textContent = "";
        return;
    }

    const matches = rows.filter(r =>
        (r["Item Code"] || "").toLowerCase().includes(q) ||
        (r["UPC"] || "").toLowerCase().includes(q) ||
        (r["Desc"] || "").toLowerCase().includes(q)
    );

    render(matches.slice(0, 200)); // cap for mobile performance
    document.getElementById("count").textContent =
        `${matches.length} match(es)`;
});

function parseCSV(text) {
    const lines = text.split(/\r?\n/).filter(l => l.trim());
    headers = lines[0].split(",").map(h => h.replace(/"/g, "").trim());

    rows = lines.slice(1).map(line => {
        const values = parseLine(line);
        let obj = {};
        headers.forEach((h, i) => obj[h] = values[i] || "");
        return obj;
    });

    renderHeader();
}

function parseLine(line) {
    let res = [];
    let cur = "";
    let q = false;

    for (let i = 0; i < line.length; i++) {
        let c = line[i];
        if (c === '"' && line[i + 1] === '"') {
            cur += '"';
            i++;
        } else if (c === '"') {
            q = !q;
        } else if (c === "," && !q) {
            res.push(cur);
            cur = "";
        } else {
            cur += c;
        }
    }
    res.push(cur);
    return res;
}

function renderHeader() {
    const tr = document.createElement("tr");
    headers.forEach(h => {
        const th = document.createElement("th");
        th.textContent = h;
        tr.appendChild(th);
    });
    document.getElementById("thead").appendChild(tr);
}

function render(data) {
    const tbody = document.getElementById("tbody");
    tbody.innerHTML = "";

    data.forEach(row => {
        const tr = document.createElement("tr");
        headers.forEach(h => {
            const td = document.createElement("td");
            td.textContent = row[h];
            tr.appendChild(td);
        });
        tbody.appendChild(tr);
    });
}
</script>

</body>
</html>
